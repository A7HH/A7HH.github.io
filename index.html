<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Your Memories</title>
    
    <!-- Google API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>

    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #1e1e2f, #3a3a5f);
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }

        .container {
            width: 80%;
            max-width: 900px;
            margin: auto;
            background: linear-gradient(135deg, #25253a, #2f2f50);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .upload-btn {
            background: linear-gradient(45deg, #ff9800, #ff5722);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .memory-container {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 10px;
            background: linear-gradient(90deg, #3b3b6b, #2d2d4a);
            border-radius: 8px;
            scroll-behavior: smooth;
            position: relative;
        }

        .memory-container img, .memory-container video, .memory-container audio {
            max-height: 150px;
            border-radius: 8px;
        }

        .scroll-btn {
            background: linear-gradient(45deg, #ff9800, #ff5722);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Upload Your Memory!</h1>
        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Add Memory</button>
        <input type="file" id="fileInput" style="display: none;" onchange="uploadFile()">

        <h2>Photos</h2>
        <div style="position: relative;">
            <button class="scroll-btn" style="left: 5px;" onclick="scrollLeft('photos')">◀</button>
            <div id="photos" class="memory-container"></div>
            <button class="scroll-btn" style="right: 5px;" onclick="scrollRight('photos')">▶</button>
        </div>

        <h2>Videos</h2>
        <div style="position: relative;">
            <button class="scroll-btn" style="left: 5px;" onclick="scrollLeft('videos')">◀</button>
            <div id="videos" class="memory-container"></div>
            <button class="scroll-btn" style="right: 5px;" onclick="scrollRight('videos')">▶</button>
        </div>

        <h2>Audio</h2>
        <div style="position: relative;">
            <button class="scroll-btn" style="left: 5px;" onclick="scrollLeft('audio')">◀</button>
            <div id="audio" class="memory-container"></div>
            <button class="scroll-btn" style="right: 5px;" onclick="scrollRight('audio')">▶</button>
        </div>
    </div>

    <script>
        let apiKey = "AIzaSyCrFx1RUDumabxURGpqPJ0c-AVAqAT42Pw";
        let clientId = "584324002833-0usenajkp6l70gl72hm72pag4r0mbm0b.apps.googleusercontent.com";
        let accessToken = "";

        // Google Sign-In for API access
        function handleAuthClick() {
            gapi.auth2.getAuthInstance().signIn().then(() => {
                accessToken = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token;
                fetchFileList(); // Fetch the list after successful login
            });
        }

        // Load Google API client
        function initClient() {
            gapi.client.init({
                apiKey: apiKey,
                clientId: clientId,
                scope: "https://www.googleapis.com/auth/drive.file",
                discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
            }).then(() => {
                // Listen for sign-in state changes.
                gapi.auth2.getAuthInstance().isSignedIn.listen(handleAuthClick);
                // Handle initial sign-in state.
                if (gapi.auth2.getAuthInstance().isSignedIn.get()) {
                    handleAuthClick();
                }
            });
        }

        gapi.load("client:auth2", initClient);

        function uploadFile() {
            const fileInput = document.getElementById("fileInput").files[0];
            if (!fileInput) return alert("Please select a file!");

            const metadata = { name: fileInput.name, mimeType: fileInput.type };
            const formData = new FormData();
            formData.append("metadata", new Blob([JSON.stringify(metadata)], { type: "application/json" }));
            formData.append("file", fileInput);

            fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart", {
                method: "POST",
                headers: { "Authorization": "Bearer " + accessToken },
                body: formData
            })
            .then(response => response.json())
            .then(data => { fetchFileList(); })
            .catch(error => console.error("Upload Error:", error));
        }

        function fetchFileList() {
            fetch("https://www.googleapis.com/drive/v3/files", {
                headers: { "Authorization": "Bearer " + accessToken }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("photos").innerHTML = "";
                document.getElementById("videos").innerHTML = "";
                document.getElementById("audio").innerHTML = "";
                
                data.files.forEach(file => {
                    let fileType = file.name.split('.').pop().toLowerCase();
                    let fileUrl = `https://drive.google.com/uc?id=${file.id}`;
                    let element;
                    
                    if (["png", "jpg", "jpeg", "gif"].includes(fileType)) {
                        element = `<img src="${fileUrl}" alt="Memory">`;
                        document.getElementById("photos").innerHTML += element;
                    } else if (["mp4", "webm", "ogg"].includes(fileType)) {
                        element = `<video src="${fileUrl}" controls></video>`;
                        document.getElementById("videos").innerHTML += element;
                    } else if (["mp3", "wav", "ogg"].includes(fileType)) {
                        element = `<audio src="${fileUrl}" controls></audio>`;
                        document.getElementById("audio").innerHTML += element;
                    }
                });
            })
            .catch(error => console.error("Error Fetching Files:", error));
        }

        function scrollLeft(id) {
            document.getElementById(id).scrollBy({ left: -200, behavior: 'smooth' });
        }
        function scrollRight(id) {
            document.getElementById(id).scrollBy({ left: 200, behavior: 'smooth' });
        }
    </script>
</body>
</html>
